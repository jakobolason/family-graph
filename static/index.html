<!DOCTYPE html>
<html>
<head>
    <title>Interactive Family Tree</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        #family-tree { width: 100%; height: 600px; border: 1px solid #ccc; }
        #person-details {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .hidden { display: none; }
        .detail-row { margin: 5px 0; }
        .detail-label { font-weight: bold; }
    </style>
</head>
<body>
<h1>Interactive Family Tree</h1>
<div id="family-tree"></div>

<div id="person-details" class="hidden">
    <h3>Person Details</h3>
    <div id="details-content"></div>
</div>

<script type="module">
    import init, { FamilyTreeProcessor } from '/pkg/your_crate_name.js';

    async function runApp() {
        // Initialize WASM
        await init();
        console.log('WASM initialized');

        // Create family tree processor
        const processor = new FamilyTreeProcessor();

        // Process family data (you could load from file upload here)
        await processor.process_family_data(new Uint8Array([]));

        // Get network data
        const networkData = processor.get_network_data();
        console.log('Network data:', networkData);

        // Configure vis.js options
        const options = {
            layout: {
                hierarchical: {
                    direction: 'UD',
                    sortMethod: 'directed',
                    levelSeparation: 150,
                    nodeSpacing: 200,
                }
            },
            nodes: {
                shape: 'box',
                margin: 10,
                font: { size: 16 },
                borderWidth: 2,
            },
            edges: {
                arrows: 'to',
                smooth: { type: 'curvedCW', roundness: 0.2 }
            },
            physics: false, // Disable physics for hierarchical layout
            interaction: {
                hover: true,
                selectConnectedEdges: false
            }
        };

        // Create network
        const container = document.getElementById('family-tree');
        const network = new vis.Network(container, networkData, options);

        // Handle node clicks
        network.on('click', async function(params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                console.log('Clicked node:', nodeId);

                // Get person details from WASM
                const personDetails = processor.get_person_details(nodeId);

                if (personDetails) {
                    displayPersonDetails(personDetails);
                }
            }
        });

        // Handle hover effects
        network.on('hoverNode', function(params) {
            container.style.cursor = 'pointer';
        });

        network.on('blurNode', function(params) {
            container.style.cursor = 'default';
        });

        console.log('Family tree initialized');
    }

    function displayPersonDetails(person) {
        const detailsDiv = document.getElementById('person-details');
        const contentDiv = document.getElementById('details-content');

        contentDiv.innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Name:</span> ${person.name}
                </div>
                <div class="detail-row">
                    <span class="detail-label">Birth Date:</span> ${person.birthdate}
                </div>
                <div class="detail-row">
                    <span class="detail-label">Address:</span> ${person.address}
                </div>
                <div class="detail-row">
                    <span class="detail-label">Phone:</span> ${person.phone}
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span> ${person.email}
                </div>
                <div class="detail-row">
                    <span class="detail-label">Generation:</span> ${person.generation}
                </div>
                <div class="detail-row">
                    <span class="detail-label">Additional Info:</span> ${person.additional_info}
                </div>
            `;

        detailsDiv.classList.remove('hidden');
    }

    // Start the app
    runApp().catch(console.error);
</script>
</body>
</html>